import React, { useState, useEffect } from 'react';
import { collection, addDoc, serverTimestamp } from 'firebase/firestore';
import { db } from '../firebase/config';
import './ContactModal.css';
import SuccessModal from './SuccessModal';

const ContactModal = () => {
  const [formData, setFormData] = useState({
    name: '',
    phone: '',
    message: ''
  });
  const [selectedCountry, setSelectedCountry] = useState({ flag: 'ğŸ‡¦ğŸ‡ª', code: '+971', name: 'UAE' });
  const [filteredCountries, setFilteredCountries] = useState([]);
  const [searchTerm, setSearchTerm] = useState('');
  const [showSuccess, setShowSuccess] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [userLocationData, setUserLocationData] = useState({
    ip: '',
    country: 'UAE',
    city: '',
    region: ''
  });

  const countries = [
    { flag: 'ğŸ‡¦ğŸ‡«', code: '+93', name: 'Afghanistan' },
    { flag: 'ğŸ‡¦ğŸ‡±', code: '+355', name: 'Albania' },
    { flag: 'ğŸ‡©ğŸ‡¿', code: '+213', name: 'Algeria' },
    { flag: 'ğŸ‡¦ğŸ‡©', code: '+376', name: 'Andorra' },
    { flag: 'ğŸ‡¦ğŸ‡´', code: '+244', name: 'Angola' },
    { flag: 'ğŸ‡¦ğŸ‡¬', code: '+1268', name: 'Antigua and Barbuda' },
    { flag: 'ğŸ‡¦ğŸ‡·', code: '+54', name: 'Argentina' },
    { flag: 'ğŸ‡¦ğŸ‡²', code: '+374', name: 'Armenia' },
    { flag: 'ğŸ‡¦ğŸ‡º', code: '+61', name: 'Australia' },
    { flag: 'ğŸ‡¦ğŸ‡¹', code: '+43', name: 'Austria' },
    { flag: 'ğŸ‡¦ğŸ‡¿', code: '+994', name: 'Azerbaijan' },
    { flag: 'ğŸ‡§ğŸ‡¸', code: '+1242', name: 'Bahamas' },
    { flag: 'ğŸ‡§ğŸ‡­', code: '+973', name: 'Bahrain' },
    { flag: 'ğŸ‡§ğŸ‡©', code: '+880', name: 'Bangladesh' },
    { flag: 'ğŸ‡§ğŸ‡§', code: '+1246', name: 'Barbados' },
    { flag: 'ğŸ‡§ğŸ‡¾', code: '+375', name: 'Belarus' },
    { flag: 'ğŸ‡§ğŸ‡ª', code: '+32', name: 'Belgium' },
    { flag: 'ğŸ‡§ğŸ‡¿', code: '+501', name: 'Belize' },
    { flag: 'ğŸ‡§ğŸ‡¯', code: '+229', name: 'Benin' },
    { flag: 'ğŸ‡§ğŸ‡¹', code: '+975', name: 'Bhutan' },
    { flag: 'ğŸ‡§ğŸ‡´', code: '+591', name: 'Bolivia' },
    { flag: 'ğŸ‡§ğŸ‡¦', code: '+387', name: 'Bosnia and Herzegovina' },
    { flag: 'ğŸ‡§ğŸ‡¼', code: '+267', name: 'Botswana' },
    { flag: 'ğŸ‡§ğŸ‡·', code: '+55', name: 'Brazil' },
    { flag: 'ğŸ‡§ğŸ‡³', code: '+673', name: 'Brunei' },
    { flag: 'ğŸ‡§ğŸ‡¬', code: '+359', name: 'Bulgaria' },
    { flag: 'ğŸ‡§ğŸ‡«', code: '+226', name: 'Burkina Faso' },
    { flag: 'ğŸ‡§ğŸ‡®', code: '+257', name: 'Burundi' },
    { flag: 'ğŸ‡°ğŸ‡­', code: '+855', name: 'Cambodia' },
    { flag: 'ğŸ‡¨ğŸ‡²', code: '+237', name: 'Cameroon' },
    { flag: 'ğŸ‡¨ğŸ‡¦', code: '+1', name: 'Canada' },
    { flag: 'ğŸ‡¨ğŸ‡»', code: '+238', name: 'Cape Verde' },
    { flag: 'ğŸ‡¨ğŸ‡«', code: '+236', name: 'Central African Republic' },
    { flag: 'ğŸ‡¹ğŸ‡©', code: '+235', name: 'Chad' },
    { flag: 'ğŸ‡¨ğŸ‡±', code: '+56', name: 'Chile' },
    { flag: 'ğŸ‡¨ğŸ‡³', code: '+86', name: 'China' },
    { flag: 'ğŸ‡¨ğŸ‡´', code: '+57', name: 'Colombia' },
    { flag: 'ğŸ‡°ğŸ‡²', code: '+269', name: 'Comoros' },
    { flag: 'ğŸ‡¨ğŸ‡©', code: '+243', name: 'Congo (DRC)' },
    { flag: 'ğŸ‡¨ğŸ‡¬', code: '+242', name: 'Congo (Republic)' },
    { flag: 'ğŸ‡¨ğŸ‡·', code: '+506', name: 'Costa Rica' },
    { flag: 'ğŸ‡­ğŸ‡·', code: '+385', name: 'Croatia' },
    { flag: 'ğŸ‡¨ğŸ‡º', code: '+53', name: 'Cuba' },
    { flag: 'ğŸ‡¨ğŸ‡¾', code: '+357', name: 'Cyprus' },
    { flag: 'ğŸ‡¨ğŸ‡¿', code: '+420', name: 'Czech Republic' },
    { flag: 'ğŸ‡©ğŸ‡°', code: '+45', name: 'Denmark' },
    { flag: 'ğŸ‡©ğŸ‡¯', code: '+253', name: 'Djibouti' },
    { flag: 'ğŸ‡©ğŸ‡²', code: '+1767', name: 'Dominica' },
    { flag: 'ğŸ‡©ğŸ‡´', code: '+1809', name: 'Dominican Republic' },
    { flag: 'ğŸ‡ªğŸ‡¨', code: '+593', name: 'Ecuador' },
    { flag: 'ğŸ‡ªğŸ‡¬', code: '+20', name: 'Egypt' },
    { flag: 'ğŸ‡¸ğŸ‡»', code: '+503', name: 'El Salvador' },
    { flag: 'ğŸ‡¬ğŸ‡¶', code: '+240', name: 'Equatorial Guinea' },
    { flag: 'ğŸ‡ªğŸ‡·', code: '+291', name: 'Eritrea' },
    { flag: 'ğŸ‡ªğŸ‡ª', code: '+372', name: 'Estonia' },
    { flag: 'ğŸ‡ªğŸ‡¹', code: '+251', name: 'Ethiopia' },
    { flag: 'ğŸ‡«ğŸ‡¯', code: '+679', name: 'Fiji' },
    { flag: 'ğŸ‡«ğŸ‡®', code: '+358', name: 'Finland' },
    { flag: 'ğŸ‡«ğŸ‡·', code: '+33', name: 'France' },
    { flag: 'ğŸ‡¬ğŸ‡¦', code: '+241', name: 'Gabon' },
    { flag: 'ğŸ‡¬ğŸ‡²', code: '+220', name: 'Gambia' },
    { flag: 'ğŸ‡¬ğŸ‡ª', code: '+995', name: 'Georgia' },
    { flag: 'ğŸ‡©ğŸ‡ª', code: '+49', name: 'Germany' },
    { flag: 'ğŸ‡¬ğŸ‡­', code: '+233', name: 'Ghana' },
    { flag: 'ğŸ‡¬ğŸ‡·', code: '+30', name: 'Greece' },
    { flag: 'ğŸ‡¬ğŸ‡©', code: '+1473', name: 'Grenada' },
    { flag: 'ğŸ‡¬ğŸ‡¹', code: '+502', name: 'Guatemala' },
    { flag: 'ğŸ‡¬ğŸ‡³', code: '+224', name: 'Guinea' },
    { flag: 'ğŸ‡¬ğŸ‡¼', code: '+245', name: 'Guinea-Bissau' },
    { flag: 'ğŸ‡¬ğŸ‡¾', code: '+592', name: 'Guyana' },
    { flag: 'ğŸ‡­ğŸ‡¹', code: '+509', name: 'Haiti' },
    { flag: 'ğŸ‡­ğŸ‡³', code: '+504', name: 'Honduras' },
    { flag: 'ğŸ‡­ğŸ‡º', code: '+36', name: 'Hungary' },
    { flag: 'ğŸ‡®ğŸ‡¸', code: '+354', name: 'Iceland' },
    { flag: 'ğŸ‡®ğŸ‡³', code: '+91', name: 'India' },
    { flag: 'ğŸ‡®ğŸ‡©', code: '+62', name: 'Indonesia' },
    { flag: 'ğŸ‡®ğŸ‡·', code: '+98', name: 'Iran' },
    { flag: 'ğŸ‡®ğŸ‡¶', code: '+964', name: 'Iraq' },
    { flag: 'ğŸ‡®ğŸ‡ª', code: '+353', name: 'Ireland' },
    { flag: 'ğŸ‡®ğŸ‡±', code: '+972', name: 'Israel' },
    { flag: 'ğŸ‡®ğŸ‡¹', code: '+39', name: 'Italy' },
    { flag: 'ğŸ‡¯ğŸ‡²', code: '+1876', name: 'Jamaica' },
    { flag: 'ğŸ‡¯ğŸ‡µ', code: '+81', name: 'Japan' },
    { flag: 'ğŸ‡¯ğŸ‡´', code: '+962', name: 'Jordan' },
    { flag: 'ğŸ‡°ğŸ‡¿', code: '+7', name: 'Kazakhstan' },
    { flag: 'ğŸ‡°ğŸ‡ª', code: '+254', name: 'Kenya' },
    { flag: 'ğŸ‡°ğŸ‡®', code: '+686', name: 'Kiribati' },
    { flag: 'ğŸ‡°ğŸ‡µ', code: '+850', name: 'North Korea' },
    { flag: 'ğŸ‡°ğŸ‡·', code: '+82', name: 'South Korea' },
    { flag: 'ğŸ‡°ğŸ‡¼', code: '+965', name: 'Kuwait' },
    { flag: 'ğŸ‡°ğŸ‡¬', code: '+996', name: 'Kyrgyzstan' },
    { flag: 'ğŸ‡±ğŸ‡¦', code: '+856', name: 'Laos' },
    { flag: 'ğŸ‡±ğŸ‡»', code: '+371', name: 'Latvia' },
    { flag: 'ğŸ‡±ğŸ‡§', code: '+961', name: 'Lebanon' },
    { flag: 'ğŸ‡±ğŸ‡¸', code: '+266', name: 'Lesotho' },
    { flag: 'ğŸ‡±ğŸ‡·', code: '+231', name: 'Liberia' },
    { flag: 'ğŸ‡±ğŸ‡¾', code: '+218', name: 'Libya' },
    { flag: 'ğŸ‡±ğŸ‡®', code: '+423', name: 'Liechtenstein' },
    { flag: 'ğŸ‡±ğŸ‡¹', code: '+370', name: 'Lithuania' },
    { flag: 'ğŸ‡±ğŸ‡º', code: '+352', name: 'Luxembourg' },
    { flag: 'ğŸ‡²ğŸ‡°', code: '+389', name: 'North Macedonia' },
    { flag: 'ğŸ‡²ğŸ‡¬', code: '+261', name: 'Madagascar' },
    { flag: 'ğŸ‡²ğŸ‡¼', code: '+265', name: 'Malawi' },
    { flag: 'ğŸ‡²ğŸ‡¾', code: '+60', name: 'Malaysia' },
    { flag: 'ğŸ‡²ğŸ‡»', code: '+960', name: 'Maldives' },
    { flag: 'ğŸ‡²ğŸ‡±', code: '+223', name: 'Mali' },
    { flag: 'ğŸ‡²ğŸ‡¹', code: '+356', name: 'Malta' },
    { flag: 'ğŸ‡²ğŸ‡­', code: '+692', name: 'Marshall Islands' },
    { flag: 'ğŸ‡²ğŸ‡·', code: '+222', name: 'Mauritania' },
    { flag: 'ğŸ‡²ğŸ‡º', code: '+230', name: 'Mauritius' },
    { flag: 'ğŸ‡²ğŸ‡½', code: '+52', name: 'Mexico' },
    { flag: 'ğŸ‡«ğŸ‡²', code: '+691', name: 'Micronesia' },
    { flag: 'ğŸ‡²ğŸ‡©', code: '+373', name: 'Moldova' },
    { flag: 'ğŸ‡²ğŸ‡¨', code: '+377', name: 'Monaco' },
    { flag: 'ğŸ‡²ğŸ‡³', code: '+976', name: 'Mongolia' },
    { flag: 'ğŸ‡²ğŸ‡ª', code: '+382', name: 'Montenegro' },
    { flag: 'ğŸ‡²ğŸ‡¦', code: '+212', name: 'Morocco' },
    { flag: 'ğŸ‡²ğŸ‡¿', code: '+258', name: 'Mozambique' },
    { flag: 'ğŸ‡²ğŸ‡²', code: '+95', name: 'Myanmar' },
    { flag: 'ğŸ‡³ğŸ‡¦', code: '+264', name: 'Namibia' },
    { flag: 'ğŸ‡³ğŸ‡·', code: '+674', name: 'Nauru' },
    { flag: 'ğŸ‡³ğŸ‡µ', code: '+977', name: 'Nepal' },
    { flag: 'ğŸ‡³ğŸ‡±', code: '+31', name: 'Netherlands' },
    { flag: 'ğŸ‡³ğŸ‡¿', code: '+64', name: 'New Zealand' },
    { flag: 'ğŸ‡³ğŸ‡®', code: '+505', name: 'Nicaragua' },
    { flag: 'ğŸ‡³ğŸ‡ª', code: '+227', name: 'Niger' },
    { flag: 'ğŸ‡³ğŸ‡¬', code: '+234', name: 'Nigeria' },
    { flag: 'ğŸ‡³ğŸ‡´', code: '+47', name: 'Norway' },
    { flag: 'ğŸ‡´ğŸ‡²', code: '+968', name: 'Oman' },
    { flag: 'ğŸ‡µğŸ‡°', code: '+92', name: 'Pakistan' },
    { flag: 'ğŸ‡µğŸ‡¼', code: '+680', name: 'Palau' },
    { flag: 'ğŸ‡µğŸ‡¦', code: '+507', name: 'Panama' },
    { flag: 'ğŸ‡µğŸ‡¬', code: '+675', name: 'Papua New Guinea' },
    { flag: 'ğŸ‡µğŸ‡¾', code: '+595', name: 'Paraguay' },
    { flag: 'ğŸ‡µğŸ‡ª', code: '+51', name: 'Peru' },
    { flag: 'ğŸ‡µğŸ‡­', code: '+63', name: 'Philippines' },
    { flag: 'ğŸ‡µğŸ‡±', code: '+48', name: 'Poland' },
    { flag: 'ğŸ‡µğŸ‡¹', code: '+351', name: 'Portugal' },
    { flag: 'ğŸ‡¶ğŸ‡¦', code: '+974', name: 'Qatar' },
    { flag: 'ğŸ‡·ğŸ‡´', code: '+40', name: 'Romania' },
    { flag: 'ğŸ‡·ğŸ‡º', code: '+7', name: 'Russia' },
    { flag: 'ğŸ‡·ğŸ‡¼', code: '+250', name: 'Rwanda' },
    { flag: 'ğŸ‡¼ğŸ‡¸', code: '+685', name: 'Samoa' },
    { flag: 'ğŸ‡¸ğŸ‡²', code: '+378', name: 'San Marino' },
    { flag: 'ğŸ‡¸ğŸ‡¹', code: '+239', name: 'SÃ£o TomÃ© and PrÃ­ncipe' },
    { flag: 'ğŸ‡¸ğŸ‡¦', code: '+966', name: 'Saudi Arabia' },
    { flag: 'ğŸ‡¸ğŸ‡³', code: '+221', name: 'Senegal' },
    { flag: 'ğŸ‡·ğŸ‡¸', code: '+381', name: 'Serbia' },
    { flag: 'ğŸ‡¸ğŸ‡¨', code: '+248', name: 'Seychelles' },
    { flag: 'ğŸ‡¸ğŸ‡±', code: '+232', name: 'Sierra Leone' },
    { flag: 'ğŸ‡¸ğŸ‡¬', code: '+65', name: 'Singapore' },
    { flag: 'ğŸ‡¸ğŸ‡°', code: '+421', name: 'Slovakia' },
    { flag: 'ğŸ‡¸ğŸ‡®', code: '+386', name: 'Slovenia' },
    { flag: 'ğŸ‡¸ğŸ‡§', code: '+677', name: 'Solomon Islands' },
    { flag: 'ğŸ‡¸ğŸ‡´', code: '+252', name: 'Somalia' },
    { flag: 'ğŸ‡¿ğŸ‡¦', code: '+27', name: 'South Africa' },
    { flag: 'ğŸ‡¸ğŸ‡¸', code: '+211', name: 'South Sudan' },
    { flag: 'ğŸ‡ªğŸ‡¸', code: '+34', name: 'Spain' },
    { flag: 'ğŸ‡±ğŸ‡°', code: '+94', name: 'Sri Lanka' },
    { flag: 'ğŸ‡¸ğŸ‡©', code: '+249', name: 'Sudan' },
    { flag: 'ğŸ‡¸ğŸ‡·', code: '+597', name: 'Suriname' },
    { flag: 'ğŸ‡¸ğŸ‡¿', code: '+268', name: 'Eswatini' },
    { flag: 'ğŸ‡¸ğŸ‡ª', code: '+46', name: 'Sweden' },
    { flag: 'ğŸ‡¨ğŸ‡­', code: '+41', name: 'Switzerland' },
    { flag: 'ğŸ‡¸ğŸ‡¾', code: '+963', name: 'Syria' },
    { flag: 'ğŸ‡¹ğŸ‡¼', code: '+886', name: 'Taiwan' },
    { flag: 'ğŸ‡¹ğŸ‡¯', code: '+992', name: 'Tajikistan' },
    { flag: 'ğŸ‡¹ğŸ‡¿', code: '+255', name: 'Tanzania' },
    { flag: 'ğŸ‡¹ğŸ‡­', code: '+66', name: 'Thailand' },
    { flag: 'ğŸ‡¹ğŸ‡±', code: '+670', name: 'East Timor' },
    { flag: 'ğŸ‡¹ğŸ‡¬', code: '+228', name: 'Togo' },
    { flag: 'ğŸ‡¹ğŸ‡´', code: '+676', name: 'Tonga' },
    { flag: 'ğŸ‡¹ğŸ‡¹', code: '+1868', name: 'Trinidad and Tobago' },
    { flag: 'ğŸ‡¹ğŸ‡³', code: '+216', name: 'Tunisia' },
    { flag: 'ğŸ‡¹ğŸ‡·', code: '+90', name: 'Turkey' },
    { flag: 'ğŸ‡¹ğŸ‡²', code: '+993', name: 'Turkmenistan' },
    { flag: 'ğŸ‡¹ğŸ‡»', code: '+688', name: 'Tuvalu' },
    { flag: 'ğŸ‡ºğŸ‡¬', code: '+256', name: 'Uganda' },
    { flag: 'ğŸ‡ºğŸ‡¦', code: '+380', name: 'Ukraine' },
    { flag: 'ğŸ‡¦ğŸ‡ª', code: '+971', name: 'UAE' },
    { flag: 'ğŸ‡¬ğŸ‡§', code: '+44', name: 'United Kingdom' },
    { flag: 'ğŸ‡ºğŸ‡¸', code: '+1', name: 'United States' },
    { flag: 'ğŸ‡ºğŸ‡¾', code: '+598', name: 'Uruguay' },
    { flag: 'ğŸ‡ºğŸ‡¿', code: '+998', name: 'Uzbekistan' },
    { flag: 'ğŸ‡»ğŸ‡º', code: '+678', name: 'Vanuatu' },
    { flag: 'ğŸ‡»ğŸ‡¦', code: '+39', name: 'Vatican City' },
    { flag: 'ğŸ‡»ğŸ‡ª', code: '+58', name: 'Venezuela' },
    { flag: 'ğŸ‡»ğŸ‡³', code: '+84', name: 'Vietnam' },
    { flag: 'ğŸ‡¾ğŸ‡ª', code: '+967', name: 'Yemen' },
    { flag: 'ğŸ‡¿ğŸ‡²', code: '+260', name: 'Zambia' },
    { flag: 'ğŸ‡¿ğŸ‡¼', code: '+263', name: 'Zimbabwe' }
  ];

  // Auto-detect user's country based on IP
  useEffect(() => {
    const detectUserCountry = async () => {
      try {
        const response = await fetch('https://ipapi.co/json/');
        const data = await response.json();
        
        // Save user location data
        setUserLocationData({
          ip: data.ip || '',
          country: data.country_name || 'UAE',
          city: data.city || '',
          region: data.region || ''
        });
        
        const userCountry = countries.find(country => 
          country.name.toLowerCase().includes(data.country_name?.toLowerCase() || '') ||
          country.code === `+${data.country_calling_code}`
        );
        
        if (userCountry) {
          setSelectedCountry(userCountry);
        }
      } catch (error) {
        console.log('Could not detect country, using default UAE');
        setUserLocationData(prev => ({ ...prev, country: 'UAE' }));
      }
    };

    detectUserCountry();
    setFilteredCountries(countries);
  }, []);

  // Filter countries based on search term
  useEffect(() => {
    if (searchTerm) {
      const filtered = countries.filter(country =>
        country.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
        country.code.includes(searchTerm)
      );
      setFilteredCountries(filtered);
    } else {
      setFilteredCountries(countries);
    }
  }, [searchTerm]);

  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: value
    }));
  };

  const handleCountrySelect = (country) => {
    setSelectedCountry(country);
    setSearchTerm('');
  };

  const handleSearchChange = (e) => {
    setSearchTerm(e.target.value);
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setIsSubmitting(true);
    
    try {
      // Prepare data for Firebase
      const submissionData = {
        // Form data
        name: formData.name,
        phone: formData.phone,
        message: formData.message,
        
        // Country selection
        selectedCountry: {
          flag: selectedCountry.flag,
          code: selectedCountry.code,
          name: selectedCountry.name
        },
        
        // User location data
        userLocation: {
          ip: userLocationData.ip,
          country: userLocationData.country,
          city: userLocationData.city,
          region: userLocationData.region
        },
        
        // Timestamp
        submittedAt: serverTimestamp(),
        submittedDate: new Date().toLocaleDateString(),
        submittedTime: new Date().toLocaleTimeString(),
        
        // Status
        status: 'new',
        isRead: false
      };
      
      // Save to Firestore
      const docRef = await addDoc(collection(db, 'contactInquiries'), submissionData);
      console.log('Document written with ID: ', docRef.id);
      
      // Reset form
      setFormData({ name: '', phone: '', message: '' });
      
      // Show success modal
      setShowSuccess(true);
      
      // Close the contact modal
      const modal = document.getElementById('contactModal');
      const bsModal = window.bootstrap?.Modal?.getInstance(modal);
      if (bsModal) {
        bsModal.hide();
      }
      
    } catch (error) {
      console.error('Error adding document: ', error);
      alert('Sorry, there was an error submitting your inquiry. Please try again.');
    } finally {
      setIsSubmitting(false);
    }
  };

  return (
    <>
      <div
        className="modal fade"
        id="contactModal"
        tabIndex="-1"
        aria-labelledby="contactModalLabel"
        aria-hidden="true"
      >
        <div className="modal-dialog modal-dialog-centered modal-lg">
          <div className="modal-content">
            <div className="modal-header border-0">
              <h5 className="modal-title fw-bold" id="contactModalLabel">
                Get in Touch
              </h5>
              <button
                type="button"
                className="btn-close btn-close-white"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div className="modal-body">
              <div className="container-fluid">
                <div className="row g-0">
                  {/* LEFT: Contact Form */}
                  <div className="col-md-6 p-4">
                    <form onSubmit={handleSubmit}>
                      <div className="mb-3">
                        <label htmlFor="contact-name" className="form-label">
                          Name
                        </label>
                        <input
                          type="text"
                          className="form-control"
                          id="contact-name"
                          name="name"
                          placeholder="Your name"
                          value={formData.name}
                          onChange={handleInputChange}
                          required
                        />
                      </div>
                      <div className="mb-3">
                        <label htmlFor="contact-phone" className="form-label">
                          Phone
                        </label>
                        <div className="input-group">
                          <button
                            className="btn dropdown-toggle flag-dropdown"
                            type="button"
                            data-bs-toggle="dropdown"
                            aria-expanded="false"
                          >
                            {selectedCountry.flag} {selectedCountry.code}
                          </button>
                          <ul className="dropdown-menu dropdown-menu-scrollable">
                            <li>
                              <input
                                type="text"
                                className="form-control dropdown-search"
                                placeholder="Search country..."
                                value={searchTerm}
                                onChange={handleSearchChange}
                                onClick={(e) => e.stopPropagation()}
                              />
                            </li>
                            <li><hr className="dropdown-divider" /></li>
                            {filteredCountries.slice(0, 10).map((country, index) => (
                              <li key={index}>
                                <button
                                  className="dropdown-item"
                                  type="button"
                                  onClick={() => handleCountrySelect(country)}
                                >
                                  {country.flag} {country.code} {country.name}
                                </button>
                              </li>
                            ))}
                            {filteredCountries.length > 10 && (
                              <li>
                                <div className="dropdown-item-text text-muted small">
                                  {filteredCountries.length - 10} more countries available...
                                </div>
                              </li>
                            )}
                            {filteredCountries.length === 0 && (
                              <li>
                                <div className="dropdown-item-text text-muted">
                                  No countries found
                                </div>
                              </li>
                            )}
                          </ul>
                          <input
                            type="tel"
                            className="form-control"
                            id="contact-phone"
                            name="phone"
                            placeholder="123-456-7890"
                            value={formData.phone}
                            onChange={handleInputChange}
                            required
                          />
                        </div>
                      </div>
                      <div className="mb-3">
                        <label htmlFor="contact-message" className="form-label">
                          Message
                        </label>
                        <textarea
                          className="form-control"
                          id="contact-message"
                          name="message"
                          rows="4"
                          placeholder="Your message..."
                          value={formData.message}
                          onChange={handleInputChange}
                          required
                        ></textarea>
                      </div>
                      <button type="submit" className="btn btn-primary" disabled={isSubmitting}>
                        {isSubmitting ? (
                          <>
                            <span className="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                            Submitting...
                          </>
                        ) : (
                          'Submit'
                        )}
                      </button>
                    </form>
                  </div>

                  {/* RIGHT: Agent Profile */}
                  <div className="col-md-6 profile-section p-4 d-flex flex-column align-items-center justify-content-center text-center">
                    <div className="profile-accent mb-3"></div>
                    <img
                      src="assets/contact.jpeg"
                      alt="Mohamad Ahmad"
                      className="agent-photo mb-3"
                    />
                    <h5 className="text-white mb-1">Mohamad Ahmad</h5>
                    <p className="text-secondary mb-3">Luxury Real Estate Agent</p>
                    <p className="text-secondary mb-4">
                      "Building bespoke property experiences in Dubai & beyond."
                    </p>
                    <div className="d-flex justify-content-center gap-3">
                      <a 
                        href="tel:+971562279111" 
                        className="text-decoration-none text-light"
                        aria-label="Call Mohamad Ahmad"
                      >
                        <i className="fa-solid fa-phone"></i>
                      </a>
                      <a 
                        href="mailto:ahmad@mr1properties.com" 
                        className="text-decoration-none text-light"
                        aria-label="Email Mohamad Ahmad"
                      >
                        <i className="fa-solid fa-envelope"></i>
                      </a>
                      <a 
                        href="https://www.linkedin.com/in/mohamadahmad" 
                        target="_blank"
                        rel="noopener noreferrer"
                        className="text-decoration-none text-light"
                        aria-label="Connect on LinkedIn"
                      >
                        <i className="fa-brands fa-linkedin"></i>
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      {/* Success Modal */}
      <SuccessModal 
        show={showSuccess} 
        onHide={() => setShowSuccess(false)}
        userCountry={userLocationData.country}
      />
    </>
  );
};

export default ContactModal;